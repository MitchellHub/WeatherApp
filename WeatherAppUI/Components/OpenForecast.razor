@page "/OpenForecast"

@inject IHttpClientFactory _clientFactory

<h3>Open Forecast</h3>

@if (string.IsNullOrWhiteSpace(errorString) == false)
{
    <div class="h2">@errorString</div>
}
else if (oneCall is null)
{
    <div class="h4">Loading...</div>
}
else
{
    <label>@oneCall.current.weather[0].main</label>
    <label>@oneCall.current.weather[0].description</label>
    @oneCall.current.pressure
}

@code {
    WeatherAppUI.Models.OpenOneCallModel oneCall;
    string errorString;

    protected override async Task OnInitializedAsync()
    {
        var requestUri = "onecall?lat=-32.92&lon=151.77&units=metric&appid=0ce35b4bcb8e83119f8f0ffd856ae84f";
        var client = _clientFactory.CreateClient("openWeather");

        try
        {
            oneCall = await client.GetFromJsonAsync<WeatherAppUI.Models.OpenOneCallModel>(requestUri);
            errorString = null;
        }
        catch (Exception ex)
        {
            errorString = $"There was an error getting our forecast: { ex.Message }";
        }
    }
}
